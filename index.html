<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>NOCIV.CO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  background:black;
  color:#ccc;
  font-family:Arial, Helvetica, sans-serif;
  text-align:center;
}

.container{
  padding:15vh 20px;
  max-width:700px;
  margin:auto;
}

h1{
  font-size:4rem;
  letter-spacing:8px;
  margin-bottom:10px;
}

.subtitle{
  font-size:1.2rem;
  letter-spacing:2px;
  margin-bottom:50px;
  color:#aaa;
}

.manifesto{
  font-size:1.2rem;
  line-height:2.2;
  margin-bottom:60px;
}

.section{ margin-top:100px; }

button{
  background:#111;
  color:#aaa;
  border:1px solid #333;
  padding:6px 12px;
  cursor:pointer;
}

button:hover{ background:#333; }

#toolContainer, #colorContainer{
  background:#1a1a1a;
  padding:15px;
  margin-top:15px;
}

#toolRow{
  display:flex;
  justify-content:center;
  gap:10px;
}

#states button{
  margin:4px;
}

canvas{
  width:100%;
  background:white;
  display:block;
  touch-action:none;
}

.feedWrap{
  border-bottom:1px solid #222;
  padding:20px 0;
}

.stateTag{
  border:1px solid #444;
  padding:4px 8px;
  font-size:12px;
}

.dateTag{
  font-size:12px;
  opacity:.6;
}
</style>
</head>

<body>

<div class="container">
<h1 id="site-title">NOCIV</h1>
<div class="subtitle" id="site-subtitle">Nothing of Civilization</div>

<p class="manifesto" id="site-manifesto">
Representing Black America.<br><br>
Showcasing present connection.<br><br>
No ads. No algorithm. Just human.
</p>

<div class="section">
<h2>Next Pop-Up</h2>
<p id="site-popup">Phoenix, AZ<br>Coming Soon</p>
</div>
</div>

<script>
fetch('content/home.json')
.then(res=>res.json())
.then(data=>{
  document.getElementById('site-title').innerText=data.title;
  document.getElementById('site-subtitle').innerText=data.subtitle;
  document.getElementById('site-manifesto').innerText=data.manifesto;
  document.getElementById('site-popup').innerText=data.popup;
});
</script>

<hr style="margin:80px 0; border-color:#222;">

<div style="max-width:900px; margin:60px auto 40px auto;">
<img src="black-america.svg" style="width:100%;">
</div>

<section style="max-width:900px; margin:auto;">

<h2 style="letter-spacing:4px;">THE STALL WALL</h2>
<p style="opacity:.7; margin-bottom:40px;">
this is how word of mouth works, it goes peer to peer and reaches different states
</p>

<div id="states"></div>

<div id="editor" style="display:none; margin-top:40px;">
<h2 id="stateTitle"></h2>

<div id="toolContainer">
<div id="toolRow"></div>
<div style="display:flex; justify-content:space-between; margin-top:10px;">
<button id="undoBtn">Undo</button>
<button id="redoBtn">Redo</button>
</div>
</div>

<canvas id="canvas"></canvas>

<div id="colorContainer">
<div id="colorBar" style="display:flex; justify-content:center; gap:10px;"></div>
</div>

<button id="sendBtn" style="margin-top:20px;">Send Mark</button>
</div>

<div style="margin-top:60px;">
<h3>Recent Marks</h3>
<div id="feedContainer" style="max-height:600px; overflow-y:auto;"></div>
</div>

</section>

<script>
const states=[ "Alabama","Alaska","Arizona","Arkansas","California","Colorado",
"Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois",
"Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland",
"Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana",
"Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York",
"North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania",
"Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah",
"Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"];

const statesDiv=document.getElementById("states");
const editor=document.getElementById("editor");
const stateTitle=document.getElementById("stateTitle");
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
const toolRow=document.getElementById("toolRow");
const colorBar=document.getElementById("colorBar");
const feed=document.getElementById("feedContainer");
const undoBtn=document.getElementById("undoBtn");
const redoBtn=document.getElementById("redoBtn");

let currentState="";
let tool="pencil";
let color="#000";
let drawing=false;
let history=[];
let redoStack=[];
let nocivMode=false;

function resizeCanvas(){
  canvas.width=canvas.offsetWidth;
  canvas.height=350;
  ctx.fillStyle="white";
  ctx.fillRect(0,0,canvas.width,canvas.height);
}
resizeCanvas();
window.addEventListener("resize",resizeCanvas);

states.forEach(s=>{
 let b=document.createElement("button");
 b.innerText=s;
 b.onclick=()=>{
   document.querySelectorAll("#states button").forEach(btn=>btn.style.background="#111");
   b.style.background="#444";
   currentState=s;
   stateTitle.innerText=s;
   editor.style.display="block";
 };
 statesDiv.appendChild(b);
});

["pencil","eraser","text"].forEach(t=>{
 let b=document.createElement("button");
 b.innerText=t;
 b.onclick=()=>{
   tool=t;
   document.querySelectorAll("#toolRow button").forEach(x=>x.style.outline="none");
   b.style.outline="2px solid white";

   if(tool==="text"){
     let text=prompt("Enter text");
     if(text){
       saveState();
       ctx.fillStyle=color;
       ctx.font="22px monospace";
       ctx.textAlign="center";
       ctx.fillText(text, canvas.width/2, canvas.height/2);
     }
   }
 };
 toolRow.appendChild(b);
});

["#0b3d2e","#8b0000","#d4a017","#000","#001f3f","#666","#ccc","#fff"].forEach(c=>{
 let sw=document.createElement("div");
 sw.style.width="28px";
 sw.style.height="28px";
 sw.style.background=c;
 sw.style.cursor="pointer";
 sw.onclick=()=>{
   color=c;
   document.querySelectorAll("#colorBar div").forEach(d=>d.style.outline="none");
   sw.style.outline="2px solid white";
 };
 colorBar.appendChild(sw);
});

function saveState(){
 history.push(canvas.toDataURL());
 redoStack=[];
}

canvas.addEventListener("mousedown",()=>{drawing=true; saveState();});
canvas.addEventListener("mouseup",()=>drawing=false);
canvas.addEventListener("mousemove",e=>{
 if(!drawing) return;
 const rect=canvas.getBoundingClientRect();
 const x=e.clientX-rect.left;
 const y=e.clientY-rect.top;

 if(tool==="pencil"){
   ctx.fillStyle=color;
   ctx.fillRect(x,y,3,3);
 }

 if(tool==="eraser"){
   ctx.clearRect(x,y,10,10);
 }
});

canvas.addEventListener("touchstart",()=>{drawing=true; saveState();});
canvas.addEventListener("touchend",()=>drawing=false);
canvas.addEventListener("touchmove",e=>{
 if(!drawing) return;
 const rect=canvas.getBoundingClientRect();
 const x=e.touches[0].clientX-rect.left;
 const y=e.touches[0].clientY-rect.top;

 if(tool==="pencil"){
   ctx.fillStyle=color;
   ctx.fillRect(x,y,3,3);
 }

 if(tool==="eraser"){
   ctx.clearRect(x,y,10,10);
 }
});

undoBtn.onclick=()=>{
 if(history.length){
   redoStack.push(canvas.toDataURL());
   let img=new Image();
   img.src=history.pop();
   img.onload=()=>ctx.drawImage(img,0,0);
 }
};

redoBtn.onclick=()=>{
 if(redoStack.length){
   history.push(canvas.toDataURL());
   let img=new Image();
   img.src=redoStack.pop();
   img.onload=()=>ctx.drawImage(img,0,0);
 }
};

window.addEventListener("keydown",e=>{
 if(e.ctrlKey && e.shiftKey && e.key.toLowerCase()==="n"){
   nocivMode=true;
   alert("NOCIV mode enabled");
 }
});

document.getElementById("sendBtn").onclick=()=>{
 const image=canvas.toDataURL();
 const today=new Date();
 const month=today.toLocaleString('en-US',{month:'short'}).toLowerCase();
 const date=`${month}.${today.getDate()}.${today.getFullYear()}`;
 const post={state:currentState,image,date,time:Date.now(),nociv:nocivMode};

 let posts=JSON.parse(localStorage.getItem("stallPosts"))||[];
 posts.unshift(post);
 localStorage.setItem("stallPosts",JSON.stringify(posts));

 ctx.fillStyle="white";
 ctx.fillRect(0,0,canvas.width,canvas.height);

 nocivMode=false;
 renderFeed();
};

function renderFeed(){
 feed.innerHTML="";
 let posts=JSON.parse(localStorage.getItem("stallPosts"))||[];
 posts=posts.filter(p=>Date.now()-p.time<30*24*60*60*1000);

 posts.slice(0,5).forEach(p=>{
   let wrap=document.createElement("div");
   wrap.className="feedWrap";

   let header=document.createElement("div");
   header.style.display="flex";
   header.style.justifyContent="space-between";

   let tag=document.createElement("div");
   tag.className="stateTag";
   tag.innerText=p.state;

   let date=document.createElement("div");
   date.className="dateTag";
   date.innerText=p.date;

   header.appendChild(tag);
   header.appendChild(date);

   let img=document.createElement("img");
   img.src=p.image;
   img.style.width="100%";
   if(p.nociv) img.style.border="2px solid #0b3d2e";

   wrap.appendChild(header);
   wrap.appendChild(img);
   feed.appendChild(wrap);
 });
}

renderFeed();
</script>

</body>
</html>
