<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>NOCIV.CO</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      background-color: black;
      color: #cccccc; /* soft gray */
      font-family: Arial, Helvetica, sans-serif;
      text-align: center;
    }

    .container {
      padding: 15vh 20px;
      max-width: 700px;
      margin: auto;
    }

    h1 {
      font-size: 4rem;
      letter-spacing: 8px;
      margin-bottom: 10px;
    }

    .subtitle {
      font-size: 1.2rem;
      letter-spacing: 2px;
      margin-bottom: 50px;
      color: #aaaaaa;
    }

    p.manifesto {
      font-size: 1.2rem;
      line-height: 2.2;
      margin-bottom: 60px;
    }

    .section {
      margin-top: 100px;
    }

    .button {
      display: inline-block;
      padding: 15px 40px;
      border: 1px solid #cccccc;
      text-decoration: none;
      color: #cccccc;
      margin-top: 30px;
    }

    .button:hover {
      background: #cccccc;
      color: black;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1 id="site-title">NOCIV</h1>
    <div class="subtitle" id="site-subtitle">Nothing of Civilization</div>

    <p class="manifesto" id="site-manifesto">
      Representing Black America.<br><br>
      Showcasing present connection.<br><br>
      No ads. No algorithm. Just human.
    </p>

    <div class="section">
      <h2>Next Pop-Up</h2>
      <p id="site-popup">Phoenix, AZ<br>Coming Soon</p>
    </div>
  </div>

  <!-- Pull content from home.json (for Netlify CMS) -->
  <script>
    fetch('content/home.json')
      .then(res => res.json())
      .then(data => {
        document.getElementById('site-title').innerText = data.title;
        document.getElementById('site-subtitle').innerText = data.subtitle;
        document.getElementById('site-manifesto').innerText = data.manifesto;
        document.getElementById('site-popup').innerText = data.popup;
      });
  </script>
</body>
</html>
<hr style="margin:80px 0; border-color:#222;">

<section id="stall-wall" style="max-width:900px; margin:auto;">

<h2 style="letter-spacing:4px;">THE STALL WALL</h2>

<p style="opacity:.7; margin-bottom:40px;">
this is how word of mouth works, it goes peer to peer and reaches different states
</p>

<div id="states" style="margin-bottom:40px;"></div>

<div id="editor" style="display:none; margin-bottom:60px;">

<h2 id="stateTitle"></h2>

<!-- TOOL CONTAINER -->
<div style="background:#1a1a1a; padding:15px; margin-bottom:15px;">
  <div id="toolRow" style="display:flex; gap:10px; justify-content:center;"></div>
  <div style="display:flex; justify-content:space-between; margin-top:10px;">
    <button id="undoBtn">Undo</button>
    <button id="redoBtn">Redo</button>
  </div>
</div>

<canvas id="canvas" style="width:100%; background:white; display:block;"></canvas>

<!-- COLOR CONTAINER -->
<div style="background:#1a1a1a; padding:15px; margin-top:15px;">
  <div id="colorBar" style="display:flex; gap:10px; justify-content:center;"></div>
</div>

<button id="sendBtn" style="margin-top:20px;">Send Mark</button>

</div>

<!-- FEED -->
<div style="border-top:1px solid #222; padding-top:30px;">
  <h3 style="margin-bottom:20px;">Recent Marks</h3>
  <div id="feedContainer" style="max-height:600px; overflow-y:auto;"></div>
</div>

</section>

<script>
const states=[ "Alabama","Alaska","Arizona","Arkansas","California","Colorado",
"Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois",
"Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland",
"Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana",
"Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York",
"North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania",
"Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah",
"Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"];

const stateContainer=document.getElementById("states");
const editor=document.getElementById("editor");
const stateTitle=document.getElementById("stateTitle");
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
const toolRow=document.getElementById("toolRow");
const colorBar=document.getElementById("colorBar");
const sendBtn=document.getElementById("sendBtn");
const feedContainer=document.getElementById("feedContainer");
const undoBtn=document.getElementById("undoBtn");
const redoBtn=document.getElementById("redoBtn");

let currentState="";
let tool="pencil";
let color="#000";
let drawing=false;
let history=[];
let redoStack=[];
let nocivMode=false;

/* CANVAS SETUP */
function resizeCanvas(){
  canvas.width=canvas.offsetWidth;
  canvas.height=350;
  ctx.fillStyle="white";
  ctx.fillRect(0,0,canvas.width,canvas.height);
}
resizeCanvas();
window.addEventListener("resize",resizeCanvas);

/* STATES */
states.forEach(s=>{
 let b=document.createElement("button");
 b.innerText=s;
 styleStateBtn(b);
 b.onclick=()=>{
   document.querySelectorAll("#states button").forEach(btn=>btn.style.background="#111");
   b.style.background="#444";
   currentState=s;
   stateTitle.innerText=s;
   editor.style.display="block";
 };
 stateContainer.appendChild(b);
});

/* TOOLS */
const tools=["pencil","eraser","spray","fill","text"];
tools.forEach(t=>{
 let b=document.createElement("button");
 b.innerText=t;
 styleToolBtn(b);
 b.onclick=()=>{
   tool=t;
   document.querySelectorAll("#toolRow button").forEach(x=>x.style.outline="none");
   b.style.outline="2px solid white";

   if(tool==="text"){
     let text = prompt("Enter text");
     if(text){
       saveState();
       ctx.fillStyle=color;
       ctx.font="20px monospace";
       ctx.textAlign="center";
       ctx.fillText(text, canvas.width/2, canvas.height/2);
     }
   }
};
   document.querySelectorAll("#toolRow button").forEach(x=>x.style.outline="none");
   b.style.outline="2px solid white";
 };
 toolRow.appendChild(b);
});

/* COLORS */
const colors=["#0b3d2e","#8b0000","#d4a017","#000","#001f3f","#666","#ccc","#fff"];
colors.forEach(c=>{
 let sw=document.createElement("div");
 sw.style.width="28px";
 sw.style.height="28px";
 sw.style.background=c;
 sw.style.cursor="pointer";
 sw.onclick=()=>{
   color=c;
   document.querySelectorAll("#colorBar div").forEach(d=>d.style.outline="none");
   sw.style.outline="2px solid white";
 };
 colorBar.appendChild(sw);
});

/* DRAW */
canvas.style.touchAction = "none";

function startDraw(e){
  drawing = true;
  saveState();
}

function endDraw(){
  drawing = false;
}

function draw(e){
  if(!drawing) return;

  const rect = canvas.getBoundingClientRect();
  const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
  const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;

  if(tool==="pencil"){
    ctx.fillStyle=color;
    ctx.fillRect(x,y,3,3);
  }

  if(tool==="eraser"){
    ctx.clearRect(x,y,10,10);
  }
}

canvas.addEventListener("mousedown",startDraw);
canvas.addEventListener("mouseup",endDraw);
canvas.addEventListener("mousemove",draw);

canvas.addEventListener("touchstart",startDraw);
canvas.addEventListener("touchend",endDraw);
canvas.addEventListener("touchmove",draw);
 if(!drawing) return;
 if(tool==="pencil"){
   ctx.fillStyle=color;
   ctx.fillRect(e.offsetX,e.offsetY,3,3);
 }
 if(tool==="eraser"){
   ctx.clearRect(e.offsetX,e.offsetY,10,10);
 }
 if(tool==="spray"){
   ctx.fillStyle=color;
   for(let i=0;i<10;i++){
     let dx=Math.random()*20-10;
     let dy=Math.random()*20-10;
     ctx.fillRect(e.offsetX+dx,e.offsetY+dy,1,1);
   }
 }
});

/* TEXT */
if(tool==="text"){
  let text = prompt("Enter text");
  if(text){
    saveState();
    ctx.fillStyle = color;
    ctx.font = "20px monospace";
    ctx.textAlign = "center";
    ctx.fillText(text, canvas.width/2, canvas.height/2);
  }
}

/* UNDO REDO */
function saveState(){
 history.push(canvas.toDataURL());
 redoStack=[];
}
undoBtn.onclick=()=>{
 if(history.length){
   redoStack.push(canvas.toDataURL());
   let img=new Image();
   img.src=history.pop();
   img.onload=()=>ctx.drawImage(img,0,0);
 }
};
redoBtn.onclick=()=>{
 if(redoStack.length){
   history.push(canvas.toDataURL());
   let img=new Image();
   img.src=redoStack.pop();
   img.onload=()=>ctx.drawImage(img,0,0);
 }
};

/* SECRET NOCIV MODE */
window.addEventListener("keydown", e => {
  if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === "n") {
    nocivMode = true;
    alert("NOCIV mode enabled");
  }
});

/* SEND */
sendBtn.innerText="Send Mark";
styleToolBtn(sendBtn);

sendBtn.onclick=()=>{
 const image=canvas.toDataURL();
 const today=new Date();
 const month=today.toLocaleString('en-US',{month:'short'}).toLowerCase();
 const date=`${month}.${today.getDate()}.${today.getFullYear()}`;
 const post={state:currentState,image,date,time:Date.now(),nociv:nocivMode};
 let posts=JSON.parse(localStorage.getItem("stallPosts"))||[];
 posts.unshift(post);
 localStorage.setItem("stallPosts",JSON.stringify(posts));
 ctx.fillStyle="white";
 ctx.fillRect(0,0,canvas.width,canvas.height);
 nocivMode=false;
 renderFeed();
};

/* FEED */
function renderFeed(){
 feedContainer.innerHTML="";
 let posts=JSON.parse(localStorage.getItem("stallPosts"))||[];
 posts=posts.filter(p=>Date.now()-p.time<30*24*60*60*1000);
 posts.slice(0,5).forEach(p=>{
   let wrap=document.createElement("div");
   wrap.style.borderBottom="1px solid #222";
   wrap.style.padding="20px 0";

   let header=document.createElement("div");
   header.style.display="flex";
   header.style.justifyContent="space-between";

   let tag=document.createElement("div");
   tag.innerText=p.state;
   tag.style.border="1px solid #444";
   tag.style.padding="4px 8px";
   tag.style.fontSize="12px";

   let date=document.createElement("div");
   date.innerText=p.date;
   date.style.fontSize="12px";
   date.style.opacity=".6";

   header.appendChild(tag);
   header.appendChild(date);

   let img=document.createElement("img");
   img.src=p.image;
   img.style.width="100%";
   if(p.nociv) img.style.border="2px solid green";

   wrap.appendChild(header);
   wrap.appendChild(img);
   feedContainer.appendChild(wrap);
 });
}

function styleToolBtn(b){
 b.style.background="#333";
 b.style.color="#aaa";
 b.style.border="1px solid #444";
 b.style.padding="6px 12px";
 b.style.cursor="pointer";
}
function styleStateBtn(b){
 b.style.background="#111";
 b.style.color="#aaa";
 b.style.border="1px solid #333";
 b.style.padding="6px 10px";
 b.style.cursor="pointer";
 b.style.margin="3px";
}

renderFeed();
</script>
